/*
 * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include "am33xx.dtsi"
#include "am335x-bone-common.dtsi"

/ {
	model = "TI AM335x BeagleBone";
	compatible = "ti,am335x-bone", "ti,am335x-bone-black", "ti,am335x-bone", "ti,am33xx";
};

&ldo3_reg {
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	regulator-always-on;
};

&mmc1 {
	vmmc-supply = <&vmmcsd_fixed>;
};

&mmc2 {
	vmmc-supply = <&vmmcsd_fixed>;
	pinctrl-names = "default";
	pinctrl-0 = <&emmc_pins>;
	bus-width = <8>;
	status = "okay";
};

&cpu0_opp_table {
	/*
	 * All PG 2.0 silicon may not support 1GHz but some of the early
	 * BeagleBone Blacks have PG 2.0 silicon which is guaranteed
	 * to support 1GHz OPP so enable it for PG 2.0 on this board.
	 */
	oppnitro@1000000000 {
		opp-supported-hw = <0x06 0x0100>;
	};
};

/ {
	sabre32_codec: sabre32_codec {
		compatible = "sabre32-audio-codec";
		status = "okay";
		i2c-bus = <&i2c1>; /* Isolated I2C bus on Hermes-BBB. */
	};

	botic {
		compatible = "botic-audio-card";
		status = "okay";

		pinctrl-names = "init", "default", "compat";
		pinctrl-0 = <&botic_cape_common_pins>;
		pinctrl-1 = <&botic_cape_common_pins &botic_cape_default_pins>;
		pinctrl-2 = <&botic_cape_common_pins &botic_cape_compat_pins>;

		audio-port = <&mcasp0>;
		audio-codec = <&sabre32_codec>;
		audio-codec-dai = "sabre32-hifi";

		int-masterclk-enable = <&gpio1 27 0>;
		ext-masterclk-switch = <&gpio0 15 0>;
		dsd-format-switch = <&gpio0 14 0>;
		card-power-switch = <&gpio1 18 0>;
	};
};

&am33xx_pinmux {
	botic_cape_common_pins: botic_cape_common_pins {
		pinctrl-single,pins = <
			/* onboard 24.576MHz oscillator control */
			AM33XX_IOPAD(0x86c, PIN_OUTPUT_PULLDOWN | MUX_MODE7) /* gpmc_a11.GPIO1_27 */
			/* external masterclock enable */
			AM33XX_IOPAD(0x848, PIN_OUTPUT_PULLDOWN | MUX_MODE7) /* gpmc_a2.gpio1_18 */
			/* external masterclock switch */
			AM33XX_IOPAD(0x984, PIN_OUTPUT_PULLDOWN | MUX_MODE7) /* uart1_txd.gpio0_15 */
			/* DSD format switch */
			AM33XX_IOPAD(0x980, PIN_OUTPUT_PULLDOWN | MUX_MODE7) /* uart1_rxd.gpio0_14 */
			/* master clock */
			AM33XX_IOPAD(0x9ac, PIN_INPUT           | MUX_MODE0) /* mcasp0_ahcklx.mcasp0_ahclkx */
			/* bitclock */
			AM33XX_IOPAD(0x990, PIN_INPUT           | MUX_MODE0) /* mcasp0_aclkx.mcasp0_aclkx */
			/* wordclock */
			AM33XX_IOPAD(0x994, PIN_INPUT           | MUX_MODE0) /* mcasp0_fsx.mcasp0_fsx */
			/* data pins */
			AM33XX_IOPAD(0x998, PIN_INPUT           | MUX_MODE0) /* mcasp0_axr0.mcasp0_axr0 */
			AM33XX_IOPAD(0x9a8, PIN_INPUT           | MUX_MODE0) /* mcasp0_axr1.mcasp0_axr1 */
			AM33XX_IOPAD(0x9a4, PIN_INPUT           | MUX_MODE2) /* mcasp0_fsr.mcasp0_axr3 */
			/* disable CLKOUT2 to allow usage of mcasp0_axr1 on P9_42 */
			AM33XX_IOPAD(0x9b4, PIN_INPUT           | MUX_MODE7) /* xdma_event_intr1.gpio0_20 */
		>;
	};
	botic_cape_default_pins: botic_cape_default_pins {
		/* this configuration will allow to use AHCLKR in asynchronous mode later */
		pinctrl-single,pins = <
			/* data pins */
			AM33XX_IOPAD(0x9a0, PIN_INPUT           | MUX_MODE2) /* mcasp0_ahclkr.mcasp0_axr2 */
			/* disable eCAP0_in_PWM0_out to allow usage of mcasp0_axr2 on P9_41 */
			AM33XX_IOPAD(0x964, PIN_INPUT           | MUX_MODE7) /* ecap0_in_pwm0_out.gpio0_7 */
		>;
	};
	botic_cape_compat_pins: botic_cape_compat_pins {
		/* compatible with original BBB setup, this output is connected also to HDMI transmitter */
		pinctrl-single,pins = <
			/* data pins */
			AM33XX_IOPAD(0x99c, PIN_INPUT           | MUX_MODE2) /* mcasp0_ahclkr.mcasp0_axr2 */
		>;
	};

	i2c1_pins: pinmux_bb_i2c1_pins {
		pinctrl-single,pins = <
			0x158 0x72
			0x15c 0x72
		>;
	};
};

&rtc {
	system-power-controller;
};

&mcasp0 {
	status = "okay";
	op-mode = <0>;		/* MCASP_IIS_MODE */
	tdm-slots = <2>;
	num-serializer = <4>;
	serial-dir = <	/* 0: INACTIVE, 1: TX, 2: RX */
		1 1 1 1
	>;
	tx-num-evt = <16>;
	rx-num-evt = <1>;
};

/* Enable ADC driver. */
&tscadc {
	status = "okay";
};

/* (Hermes-BBB) A digital volume pot is connected to the AIN4. */
&am335x_adc {
	ti,adc-channels = <4>;
};

/* (Hermes-BBB) The I2C1 for isolated I2C access. */
&i2c1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&i2c1_pins>;
	clock-frequency = <100000>;
};

